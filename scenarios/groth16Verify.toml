# groth16Verify.toml
# Realistic groth16 proof verification stress test
# Inspired by: Worldchain proof-of-humanity
# 
# This scenario simulates groth16 proof verification traffic by:
# - Deploying a realistic groth16 verifier contract
# - Fuzzing all proof inputs for unique transactions (prevents caching)
# - Exercising ecPairing (0x08), ecMul (0x07), and ecAdd (0x06) precompiles
# - Creating realistic state growth (nullifier storage)
# - Achieving ~300k gas per transaction

[[create]]
name = "Groth16Verifier"
bytecode = "0x6080604052348015600e575f80fd5b5060015f81815260208290527fcc69885fda6bcc1a4ace058b4a62bf5e179ea78fd58a1ccd71c22cc9b688792f805460ff1916831790556040517ff9455e5b44defc549f73e539ddaae9802f5d9b8d18755c421d94c39c6e84e8319190a2611229806100795f395ff3fe608060405234801561000f575f80fd5b506004361061007a575f3560e01c80639f971cac116100585780639f971cac146100da578063aa2d61db146100ed578063c6c0572d1461010f578063e8aaf83e14610131575f80fd5b80631f79a1e91461007e57806324360b62146100b45780633bc778e3146100c7575b5f80fd5b6100a061008c366004611123565b5f6020819052908152604090205460ff1681565b604051901515815260200160405180910390f35b6100a06100c236600461113a565b610146565b6100a06100d536600461115a565b6101df565b6100a06100e83660046111b0565b610444565b6100a06100fb366004611123565b60016020525f908152604090205460ff1681565b6100a061011d366004611123565b5f9081526020819052604090205460ff1690565b61014461013f366004611123565b610494565b005b5f7f30644e72e131a029b85045b68181585d97816a916871ca8d3c208c16d87cfd4780841015806101775750808310155b15610185575f9150506101d9565b83158015610191575082155b156101a05760019150506101d9565b5f6040518060600160405280868152602001858152602001600181525090506101c76110c8565b5f60408260608560075afa9450505050505b92915050565b5f8681526001602052604081205460ff166102415760405162461bcd60e51b815260206004820152601d60248201527f47726f7468313656657269666965723a20696e76616c696420726f6f7400000060448201526064015b60405180910390fd5b5f8481526020819052604090205460ff16156102af5760405162461bcd60e51b815260206004820152602760248201527f47726f7468313656657269666965723a206e756c6c696669657220616c726561604482015266191e481d5cd95960ca1b6064820152608401610238565b856001146103095760405162461bcd60e51b815260206004820152602160248201527f47726f7468313656657269666965723a20696e76616c69642067726f757020496044820152601160fa1b6064820152608401610238565b60408051600580825260c082019092525f916020820160a08036833701905050905087815f8151811061033e5761033e6111df565b602002602001018181525050848160018151811061035e5761035e6111df565b602002602001018181525050858160028151811061037e5761037e6111df565b602002602001018181525050838160038151811061039e5761039e6111df565b60200260200101818152505086816004815181106103be576103be6111df565b6020026020010181815250505f6103d4826104d9565b90506103e0848261082b565b505f8681526020819052604090819020805460ff191660011790555186907fd4f3db4a3b56fedc0b470e2e34b8d98c7baf6e0c2c02edebb326437ba5c4b93f9061042d908c815260200190565b60405180910390a250600198975050505050505050565b5f7f30644e72e131a029b85045b68181585d97816a916871ca8d3c208c16d87cfd47808610801561047457508085105b801561047f57508084105b801561048a57508083105b9695505050505050565b5f818152600160208190526040808320805460ff19169092179091555182917ff9455e5b44defc549f73e539ddaae9802f5d9b8d18755c421d94c39c6e84e83191a250565b6104e16110c8565b5f8083516005146105425760405162461bcd60e51b815260206004820152602560248201527f576f726c64494456657269666965723a20696e76616c696420696e707574206c6044820152640cadccee8d60db1b6064820152608401610238565b5f5b84518110156107c4577f30644e72e131a029b85045b68181585d2833e84879b9709143e1f593f0000001858281518110610580576105806111df565b6020026020010151106105ea5760405162461bcd60e51b815260206004820152602c60248201527f576f726c64494456657269666965723a20696e707574203e3d20534e41524b5f60448201526b14d0d053105497d19251531160a21b6064820152608401610238565b5f80825f0361063d57507f20b781dd0db3b7980a4b3814128c86e597e1442d0fc9eb7f932a5229494d6b7990507f17d1cef436eb2f665670c7b34854e62c227043a7b111a539c0295518bbab3ca9610779565b8260010361068f57507f260945445b4205f874ab7e203a18240e51c9d3c896ea300d40132b1c2f50299a90507f11087a8b76b0f957e1c482c909302916795f811a06866059e403689c01c903fb610779565b826002036106e157507f11d20fd81c0e5cf48ba1469ccb8ac99dcdc7cf746a6e70762a939d63dcc52dbf90507f2d447c5f134eff527d7bcaace88b3842c42b800d8dc049e0a6e72f5efc14293d610779565b8260030361073357507f107cd54a1606a6a873bed4c1b76af48975e66dcf6c127b4c799ad4fdd230b87c90507f1a51b81f6c07725ebcc56ebb1c482b99340eaa9bcb86cc09aed6f58a28e530b6610779565b507f20b781dd0db3b7980a4b3814128c86e597e1442d0fc9eb7f932a5229494d6b7990507f17d1cef436eb2f665670c7b34854e62c227043a7b111a539c0295518bbab3ca95b5f8061079f84848b8881518110610792576107926111df565b6020026020010151610f91565b915091506107af87878484611029565b90975095505060019093019250610544915050565b5061081182827f0335f514c2acb9b255aae85514122267cd7d16e374c6231a2c34417d344912547f07fa1580c1cc3ed4f6d660c6f60f86afedd8a12fb90b2e8ed4f7e310c88b97f7611029565b604080518082019091529182526020820152949350505050565b5f61083f83358460015b6020020135610146565b6108805760405162461bcd60e51b8152602060048201526012602482015271496e76616c696420473120706f696e74204160701b6044820152606401610238565b61089060c0840135846007610835565b6108d15760405162461bcd60e51b8152602060048201526012602482015271496e76616c696420473120706f696e74204360701b6044820152606401610238565b815160208301516108e29190610146565b6109265760405162461bcd60e51b8152602060048201526015602482015274092dcecc2d8d2c8408e6240e0ded2dce840ecd6bef605b1b6044820152606401610238565b6109707f2d4d9aa7e302d9df41749d5507949d05dbea33fbb16c643b22f599a2be6df2e27f14bedd503c37ceb061d8ec60209fe345ce89830a19230301f076caff004d1926610146565b6109b55760405162461bcd60e51b8152602060048201526016602482015275496e76616c696420473120706f696e7420414c50484160501b6044820152606401610238565b6109d16060840135604085013560a08601356080870135610444565b610a1d5760405162461bcd60e51b815260206004820152601860248201527f496e76616c696420473220706f696e7420422072616e676500000000000000006044820152606401610238565b610aa87f0e187847ad4c798374d0d6732bf501847dd68bc0e071241e0213bc7fc13db7ab7f0967032fcbf776d1afc985f88877f182d38480a653f2decaa9794cbc3bf3060c7f192a8cc13cd9f762871f21e43451c6ca9eeab2cb2987c4e366a185c25dac2e7f7e1752a100a72fdf1e5a5d6ea841cc20ec838bccfcf7bd559e79f1c9c759b6a0610444565b610aec5760405162461bcd60e51b8152602060048201526015602482015274496e76616c696420473220706f696e74204245544160581b6044820152606401610238565b610b787f1800deef121f1e76426a00665e5c4479674322d4f75edadd46debd5cd992f6ed7f198e9393920d483a7260bfb731fb5d25f1aa493335a9e71297e485b7aef312c27f1d9befcd05a5323e6da4d435f3b617cdb3af83285c2df711ef39c01571827f9d7f275dc4a288d1afb3cbb1ac09187524c7db36395df7be3b99e673b13a075a65ec610444565b610bbd5760405162461bcd60e51b8152602060048201526016602482015275496e76616c696420473220706f696e742047414d4d4160501b6044820152606401610238565b610c497f2139a256456825daa623957c4f2ea1a0d26f135769e450759142a7159b0a44767f168e4fddac50a40d5bcff39c7fa9207cd368444c0c01a86690a6645b52f3aa1f7f142ad7a93ca0c554a9f0303059e5a24e85400004a730598bd423b0090f4b3d4a7f07859424108de88bfbe5c80a19c0e80ba35fda4383d3fd125305dd04b4c08fe4610444565b610c8e5760405162461bcd60e51b8152602060048201526016602482015275496e76616c696420473220706f696e742044454c544160501b6044820152606401610238565b610c966110e6565b833581526020808501358282015260408086013590830152606080860135908301526080808601359083015260a0808601359083015260c0808601359083015260e080860135908301527f168e4fddac50a40d5bcff39c7fa9207cd368444c0c01a86690a6645b52f3aa1f6101008301527f2139a256456825daa623957c4f2ea1a0d26f135769e450759142a7159b0a44766101208301527f07859424108de88bfbe5c80a19c0e80ba35fda4383d3fd125305dd04b4c08fe46101408301527f142ad7a93ca0c554a9f0303059e5a24e85400004a730598bd423b0090f4b3d4a6101608301527f2d4d9aa7e302d9df41749d5507949d05dbea33fbb16c643b22f599a2be6df2e26101808301527f14bedd503c37ceb061d8ec60209fe345ce89830a19230301f076caff004d19266101a08301527f0967032fcbf776d1afc985f88877f182d38480a653f2decaa9794cbc3bf3060c6101c08301527f0e187847ad4c798374d0d6732bf501847dd68bc0e071241e0213bc7fc13db7ab6101e08301527e1752a100a72fdf1e5a5d6ea841cc20ec838bccfcf7bd559e79f1c9c759b6a06102008301527f192a8cc13cd9f762871f21e43451c6ca9eeab2cb2987c4e366a185c25dac2e7f61022083015283516102408301528301516102608201527f198e9393920d483a7260bfb731fb5d25f1aa493335a9e71297e485b7aef312c26102808201527f1800deef121f1e76426a00665e5c4479674322d4f75edadd46debd5cd992f6ed6102a08201527f275dc4a288d1afb3cbb1ac09187524c7db36395df7be3b99e673b13a075a65ec6102c08201527f1d9befcd05a5323e6da4d435f3b617cdb3af83285c2df711ef39c01571827f9d6102e0820152610f1a611105565b5f6020826103008560085afa905080610f855760405162461bcd60e51b815260206004820152602760248201527f576f726c64494456657269666965723a2070616972696e6720636865636b206660448201526661696c6564203360c81b6064820152608401610238565b50600195945050505050565b5f805f6040518060600160405280878152602001868152602001858152509050610fb96110c8565b5f60408260608560075afa9050806110135760405162461bcd60e51b815260206004820152601d60248201527f576f726c64494456657269666965723a2065634d756c206661696c65640000006044820152606401610238565b5080516020909101519097909650945050505050565b5f805f60405180608001604052808881526020018781526020018681526020018581525090506110576110c8565b5f60408260808560065afa9050806110b15760405162461bcd60e51b815260206004820152601d60248201527f576f726c64494456657269666965723a206563416464206661696c65640000006044820152606401610238565b508051602090910151909890975095505050505050565b60405180604001604052806002906020820280368337509192915050565b6040518061030001604052806018906020820280368337509192915050565b60405180602001604052806001906020820280368337509192915050565b5f60208284031215611133575f80fd5b5035919050565b5f806040838503121561114b575f80fd5b50508035926020909101359150565b5f805f805f806101a080888a031215611171575f80fd5b873596506020880135955060408801359450606088013593506080880135925088818901111561119f575f80fd5b5060a0870190509295509295509295565b5f805f80608085870312156111c3575f80fd5b5050823594602084013594506040840135936060013592509050565b634e487b7160e01b5f52603260045260245ffdfea264697066735822122040122778a83823ee4a45aae49857f060f4e37c082f95f6096a482893f889efb764736f6c63430008190033"
from_pool = "admin"

# Spam: groth16 proof verification with input fuzzing
# Each transaction will be unique due to fuzzed parameters
[[spam]]
[spam.tx]
kind = "groth16-verifyProof"
to = "{Groth16Verifier}"
from_pool = "spammers"
signature = "verifyProof(uint256 root, uint256 groupId, uint256 signalHash, uint256 nullifierHash, uint256 externalNullifierHash, uint256[8] proof)"
args = [
    "1",      # root - use the valid root we added in setup
    "1",      # groupId - always 1
    "0",      # signalHash - fuzzed
    "0",      # nullifierHash - fuzzed
    "0",      # externalNullifierHash - fuzzed (or use a constant)
    "[0, 0, 0, 0, 0, 0, 0, 0]"  # proof - will be replaced in code
]
gas_limit = 4000000 # Hardcoded to skip gas estimation

fuzz = [
    { param = "signalHash", min = "1", max = "0x30644e72e131a029b85045b68181585d2833e84879b9709143e1f593f0000000" },
    { param = "nullifierHash", min = "1", max = "0x30644e72e131a029b85045b68181585d2833e84879b9709143e1f593f0000000" },
    { param = "externalNullifierHash", min = "1", max = "0x30644e72e131a029b85045b68181585d2833e84879b9709143e1f593f0000000" },
]